{% extends "base.html" %}

{% block title %}Weekly Calendar{% endblock %}

{% block content %}
<h1 class="section-title">Weekly Calendar</h1>

<div id="calendarContainer">
    <div class="spinner"></div>
</div>
{% endblock %}

{% block scripts %}
<script>
    const colors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'];

    async function loadCalendarView() {
        try {
            const userClass = '{{ user.class }}';
            const response = await fetch(`/api/schedule?class=${userClass}`);
            const schedule = await response.json();

            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

            let html = '<div class="grid grid-3">';

            days.forEach(day => {
                const daySchedule = schedule[day] || [];
                const hasSchedule = daySchedule.some(s => s);

                html += `
                    <div class="card">
                        <h3 style="font-size: 20px; color: #1e293b; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #e2e8f0;">
                            ${day}
                        </h3>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                `;

                if (hasSchedule) {
                    daySchedule.slice(0, 5).forEach((subject, index) => {
                        if (subject) {
                            const color = colors[index % colors.length];
                            html += `
                                <div style="background: ${color}15; padding: 10px 15px; border-radius: 8px; border-left: 3px solid ${color};">
                                    <div style="font-size: 12px; color: #64748b; margin-bottom: 3px;">Period ${index + 1}</div>
                                    <div style="font-weight: 600; color: ${color};">${subject}</div>
                                </div>
                            `;
                        }
                    });

                    if (daySchedule.length > 5) {
                        html += `<p style="color: #64748b; font-size: 13px; text-align: center; margin-top: 5px;">+${daySchedule.length - 5} more</p>`;
                    }
                } else {
                    html += `<p style="color: #94a3b8; text-align: center; padding: 20px;">No classes scheduled</p>`;
                }

                html += `
                        </div>
                    </div>
                `;
            });

            html += '</div>';

            document.getElementById('calendarContainer').innerHTML = html;
        } catch (error) {
            document.getElementById('calendarContainer').innerHTML = `
                <div class="card text-center">
                    <p style="color: #ef4444;">Failed to load calendar</p>
                </div>
            `;
        }
    }

    loadCalendarView();
</script>
{% endblock %}